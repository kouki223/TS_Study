**Next.jsとは？**

- Next.jsとは？
    - Vercel社が開発を推進しているReactをベースにモダンなアプリケーション開発に必要な機能が追加されたフレームワーク
- Next.jsの徴的な機能
    - ルーティング
        - ディレクトリ構成、ファイル名が所定のものになっているため自動的にルーティングされる
    - パフォーマンスの最適化
        - サーバー側で事前にページを生成して初期表示に優れる
            - 画像の最適化、コード分割も自動で行なってくれる
    - CSSフレームワーク
        - Tailwind CSS
        - CSS Modeleなどのスタイリングをサポートする
    - バンドラー
        - 内部でWebpackやBabelなどの設定を行なってくれるため設定を気にする必要がない
    - サーバーサイドの動きもできる
        - DB,APIとの通信もNext.jsで可能
    - デプロイ環境
        - Vercel社が開発を推進している関係でVercelというホスティングサービスが提供されている
            - デプロイが簡単にできるという利点がある
- Next.jsのサーバーサイド機能
    - ReactをベースにしたフレームワークであるNext.jsだが、Reactが元来、UI(ブラウザ)に特化したライブラリであったため対応出来ていなかった
        - SEO対策
        - 初期表示速度
    - などの問題をSSG(静的サイト作成)、SSR(サーバーサイドレンダリング)の実装を可能にする事でAPIルートを使ってサーバーとの通信が可能になり、サーバーのデータにアクセスしやすくなるという利点が獲得された
        - 単純なフロントエンドのフレームワークだったNext.jsがAPIルートを活用してサーバーサイドとフロントエンドをシームレスに繋ぐ
            - Web APIのクライアントという概念ではなくサーバーサイドを協力にサポートするフレームワークとなっている
    - 具体的な機能
        - サーバーサイドコンポーネント
            - 初期表示速度の向上
        - APIルート
        - サーバーアクション
            - 簡単なサーバーサイドのAPIを作成する機能
                - envファイルなどでAPIキーを隠しながらルーティングされているフロントエンドからAPIを叩く事でHTTP通信などを可能にしている
                    - セキュリティ面も解決
        - ミドルウェア=>リクエストとレスポンスの間に処理を挟む機能
            - 通信において認証・認可の実装を可能にする
        - 静的サイト作成
            - サーバーサイドのDBへの直接アクセス

**猫画像ジェネレーターを作成する**

- 必要な知識
    - Next.jsの新規プロジェクトの作成
    - App Routerの使い方
    - サーバーコンポーネントとクライアントコンポーネント
    - サーバーアクションの使い方
    - 外部API連携
    - 機密情報となる資格情報(APIキー)の取り扱い

- ページコンポーネント
    - Next.jsにおいてappディレクトリ配下の構造がルーティングに対応する事になる
        - 今回は、app/page.tsxが/にアクセスした時にルーティングされるようになる
            - このapp/page.tsxのようなページの事をページコンポーネントと呼ぶ
    - Next.jsにおいては自動的にルーティングされるようになる

- ルートファイル
    - ルートファイルとは、該当のプロジェクト内で最上段のディレクトリを指す

- 外部との通信を行う
    - 猫のランダム画像を取得する
        - Cat APIというAPIを使って猫画像を取得する
            - 各API毎に決まったルールが存在する
                - API毎にAPIを叩いたレスポンスとしてどのようなデータが返ってくるのか確認する事が重要
                    - Cat APIの場合には配列形式でレスポンスが返ってくる

- fetch関数
    - ブラウザ標準のHTTPリクエストを行いリソースを取得するAPI
        - 戻り値としてresponseオブジェクトを返す
            - 戻り値は様々な形をしているため.jsonを使ってJSオブジェクトとして慣らす

- 非同期処理
    - asyncとawit
        - JavaScript,TyopeScriptにおいて処理はマルチスレッドではなく並列処理として順不同に行われる。
            - Stateの更新をする場合や、データの再取得などを行う場合には非同期処理として順番に処理を実行していく事が必要になる
                - 非同期処理を実行したい関数には関数の前にasyncキーワードをつける事で非同期処理を実行できるようになる
                    - 処理の終了まで待ちたい処理の前にはawitをつける事で処理の実行を待つ事ができる

- 関数を呼び出すタイミング
    - await connection()キーワードを準備しないSSG(静的サイト作成)
        - SSGにおいて関数が実行されるタイミングはビルド時になる
            - 今回のCatAPIを叩くアプリケーションにおいては、ビルド時にAPIを叩いてしまうとビルド時の画像が読み込まれてビルドされてしまう関係で画像が変わらなくなってしまう
    - await connection()キーワードを使ったSSG
        - await connection()キーワードを使う事でビルド時に関数が実行されなくなり、ブラウザをリロードした時に関数が呼び出されるようになる
            - ビルドしていない開発モードにおいてはキーワードがない状態でもリロードで更新されるようになる

- TypeScriptの有利な部分(関数のも戻り値に型を適用する)
    - Typeとして型を追加する事ができる(型注釈など)
        - 型を追加する事でバグが発生する可能性をコーディング段階で防ぐ事ができる
            - 特にAPIレスポンスにおいてはバグが発生しやすくなる
    - 厳格なレスポンスのチェック
        - より厳格にレスポンスデータのチェックを行う事ができる
            - any型を防ぐ
            - 型ガード
                - TSにおけるテクニックを活用する事でコーディング段階では工程が多くかかる場合でも保守、点検、運用の段階でコストをカットする事が可能になる
                    - バランスを見極める事が重要になる

- Reactコンポーネントを作成しUIに取得した画像を表示する
    - 画像の表示
        - JSXにおけるimgタブを使って画像を表示
            - src属性に表示したい画像のパスを入れる
                - 変数へパスを代入してPropsとして渡し画像を表示する
                    - ボトムアップの形で画像が表示できるようにする

- インタラクティブな要素をReactコンポーネント内で表示する
    - Reactはインタラクティブな要素を扱う事ができる
        - Reactには便利な機能がパッケージ化されたHooksと呼ばれるものがある
            - ReactにおいてHooksをうまく活用する事でユーザー行動に応じたインタラクティブな要素をReactコンポーネント内で活用する事が出来るようになる
    - クリーンアップ関数
        - インタラクティブな要素を実現させる時にUXの観点からクリーンアップ関数が使われる
            - 更新中の画像を失くして古い画像が表示されている時間を減らす

- 条件付きレンダリング
    - JSX内には{}リテラルを使う事でJSの式が記載できる
        - {}リテラルを使っても文を使う事が出来ない
    - 特定の条件に応じてReactコンポーネントの表示や非表示を切り替えたい場合にif文を使う方法や&&を使った条件式レンダリングというものがある
        - && を使って左辺の値が存在しない場合には右辺の値も評価しないという条件を式で作成する事ができる

- コンポーネントの概念
    - Reactにおけるコンポーネントとは、Web上の構造を1つ1つ部品と捉えて、部品毎(コンポーネント毎)に作業を行う事やコンポーネントを積み上げる事でUIを構築するという概念
- コンポーネントの種類
    - クライアントコンポーネント
        - "use client"ディレクティブによってクライアントサイドのコンポーネントである事を明示する
            - ブラウザ上で解釈されるReactコンポーネントであり、useStateやuseEffectなどのユーザー行動に対応する事ができる
            - ブラウザ専用のAPIが使用可能
            - コンポーネント内でUIの状態を保持できる
    - サーバーサイドコンポーネント
        - "use client"ディレクティブ無しでコンポーネントを宣言する事でサーバーサイドコンポーネントと解釈される
            - クライアントコンポーネントにはない機能がサーバーサイドコンポーネントにはある
        - サーバーサイドコンポーネントの機能
            - サーバー上のリソースへアクセス可能
                - DB
                - ファイルシステム
                - 非公開のAPI
                    - これらにアクセスする事が可能になる
            - 秘密情報を安全に扱う事ができる
                - クライアントコンポーネントにおいては開発者ツールなどを使ってコードを見る事ができる
                    - 秘密情報であるAPIなどが存在している場合などにはサーバーサイドコンポーネントがある事で安全にAPI Keyを扱う事ができる
                        - サーバーサイドコンポーネントにおいてはAPI呼び出しの結果、responseデータのみが返される
            - SEOに有利
                - サーバー上でコンポーネントがレンダリングされる事で、ブラウザが解釈できない可能性などを回避
            - API通信の効率化
                - Next.jsのキャッシュ機能
                - サーバーサイドでのデータ取得
                    - これらによってバックエンドの負荷軽減
                        - UXの改善につながる
            - 初期表示速度の高速化
                - サーバー上でレンダリングされるため初期表示が早い

- サーバーアクション
    - "use server"というディレクティブを追加する事で特定の関数を毎回サーバーサイドで実行する事が可能になる
        - 関数によっては、サーバーサイドで呼び出される関数、フロントで呼び出される関数があるが、サーバーアクションを指定した関数は毎回サーバーで実行されるようになる

- APIキーの扱い方
    - APIキーは隠す必要がある
        - .envファイルなどで環境変数を定義した上で環境変数を使ってAPIを叩くようにする

        